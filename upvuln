#!/bin/bash

# âœ¨ System Update, Upgrade, and Cleanup Script âœ¨

# ğŸ› ï¸ Check if the script is run as root
if [[ $EUID -ne 0 ]]; then
    echo "ğŸš« Error: This script must be run as root. Use sudo!"
    exit 1
fi

echo "ğŸš€ Starting system update, upgrade, and cleanup process..."

# ğŸ”„ Update package lists
echo "ğŸ”„ Updating package lists..."
if apt update; then
    echo "âœ… Package lists updated successfully."
else
    echo "âŒ Failed to update package lists."
    exit 1
fi

# â¬†ï¸ Upgrade installed packages
echo "â¬†ï¸ Upgrading installed packages..."
if apt upgrade -y; then
    echo "âœ… Packages upgraded successfully."
else
    echo "âŒ Failed to upgrade packages."
    exit 1
fi

# ğŸ—‘ï¸ Remove unnecessary packages and clean cache
echo "ğŸ—‘ï¸ Removing unnecessary packages and cleaning cache..."
if apt autoremove -y && apt autoclean; then
    echo "âœ… Unnecessary packages removed and cache cleaned."
else
    echo "âŒ Failed to clean up unnecessary packages."
    exit 1
fi

# ğŸ” Fix broken dependencies and configure pending packages
echo "ğŸ” Fixing broken dependencies and configuring pending packages..."
if dpkg --configure -a && apt install -f -y; then
    echo "âœ… No issues detected in the system."
else
    echo "âš ï¸ There might be issues that require manual resolution."
fi

# ğŸ“¦ Move the script itself (upvuln) to /usr/local/bin/
echo "ğŸ“¦ Moving upvuln to /usr/local/bin/..."
if mv "$0" /usr/local/bin/upvuln; then
    echo "âœ… upvuln moved to /usr/local/bin/ successfully."
else
    echo "âŒ Failed to move upvuln to /usr/local/bin/."
    exit 1
fi

echo "ğŸ‰ All operations completed successfully!"
